%%% PREAMBOLO %%%
\documentclass[a4paper, 12pt]{article}

%%% PACCHETTI %%%
% Layout di pagina
\usepackage[a4paper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

% Supporto linguistico
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[italian]{babel}

% Pacchetti per elementi grafici e formattazione
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{float}

% Tabelle avanzate
\usepackage{booktabs}
\usepackage{makecell}

% Matematica
\usepackage{amsmath}
\usepackage{amssymb}

% Programmazione
\usepackage{listings}

% Supporto per link e PDF
\usepackage{hyperref}
\usepackage{caption}
\usepackage{subcaption}

%%% CONFIGURAZIONI %%%
% Configurazione hyperref
\hypersetup{
    pdftitle={Progetto Tetris Arduino},
    pdfauthor={Enrico Ferraiolo},
    colorlinks=true,
    linkcolor=blue,
    citecolor=green,
    urlcolor=cyan
}

% Definizione comandi personalizzati
\newcommand{\RedBlock}{\colorbox{red}{\rule{1.2ex}{1.2ex}}}      % blocco pieno rosso
\newcommand{\WhiteBlock}{\fcolorbox{black}{white}{\rule{1.2ex}{1.2ex}}} % blocco vuoto

% Impostazione della configurazione listings per il codice
\lstset{
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue},
    commentstyle=\color{green!50!black},
    stringstyle=\color{red},
    breaklines=true,
    showstringspaces=false
}

%%% INFORMAZIONI SUL DOCUMENTO %%%
\title{\textbf{RELAZIONE: \\ Tetris Arduino}}
\author{Enrico Ferraiolo 0001191698}
\date{}

%%% INIZIO DOCUMENTO %%%
\begin{document}

% Frontespizio
\maketitle

\begin{center}
    \textbf{Laurea Magistrale in Informatica}\\
    \vspace{0.3cm}
    Corso: Laboratorio di Making\\
    a.a. 2024-2025
    \vspace{2cm}
\end{center}

\newpage

% Indice dei contenuti
\tableofcontents
\newpage

%%% CONTENUTO PRINCIPALE %%%
\section{Introduzione}
\label{sec:introduzione}
Il gioco Tetris è uno dei puzzle game più celebri di sempre: l'utente deve ruotare e spostare pezzi geometrici (``tetramini'') che cadono,
completando linee orizzontali per ottenere punti.

L'obiettivo di questo progetto è realizzare una versione giocabile su Arduino di Tetris, utilizzando:
\begin{itemize}
    \item un display a matrice LED 8x8 (MAX7219) per il campo di gioco
    \item un display LCD 16x2 per visualizzare punteggio e stato
    \item un telecomando IR e un encoder rotativo per i controlli
\end{itemize}

Lo scopo del progetto è quindi implementare una versione completamente funzionante del gioco Tetris su Arduino con diversi moduli di input e output.

\section{Componenti Hardware}
\label{sec:componenti-hardware}
Di seguito vengono elencati e descritti i componenti hardware utilizzati per il progetto.

\subsection{Microcontrollore}
\label{subsec:microcontrollore}
Il microcontrollore utilizzato è il \textbf{Elegoo UNO R3}, una scheda compatibile con Arduino UNO che fornisce tutte le funzionalità necessarie per il progetto.

\subsection{Display a matrice LED - Campo di Gioco}
\label{subsec:display-matrice}
Il display a matrice LED è un modulo \textbf{MAX7219} con configurazione 8x8. Ogni LED della matrice può essere controllato individualmente, consentendo di:
\begin{itemize}
    \item visualizzare il campo di gioco
    \item rappresentare i tetramini in movimento
    \item mostrare le celle occupate
\end{itemize}

Ogni LED rappresenta una singola cella del campo di gioco Tetris.

\subsection{Display LCD - Informazioni di Gioco}
\label{subsec:display-lcd}
Per visualizzare informazioni testuali viene utilizzato un display LCD 16x2 (\textbf{LCD 1602}). Sul display vengono mostrati:
\begin{itemize}
    \item \textbf{Punteggio}: punteggio attuale del giocatore
    \item \textbf{Stato}: stato corrente del gioco (in corso, pausa, terminato)
    \item \textbf{Velocità}: velocità di caduta dei tetramini
    \item \textbf{Istruzioni ausiliarie}: informazioni utili per il giocatore
\end{itemize}

\subsection{Controlli}
\label{subsec:controlli}
Il progetto implementa due diversi sistemi di controllo per offrire un'interazione flessibile.

\subsubsection{Controlli Infrarossi}
\label{subsubsec:controlli-ir}
Il telecomando IR consente di inviare istruzioni a distanza tramite segnali infrarossi, decodificati da un apposito ricevitore. I comandi principali sono:

\begin{table}[H]
    \centering
    \caption{Funzioni dei tasti del telecomando IR}
    \label{tab:ir-functions}
    \begin{tabular}{ll}
        \toprule
        \textbf{Tasto} & \textbf{Funzione}                    \\
        \midrule
        POWER          & Accensione/spegnimento del gioco     \\
        FAST BACK      & Movimento del tetramino a sinistra   \\
        FAST FORWARD   & Movimento del tetramino a destra     \\
        PAUSE          & Pausa/ripresa del gioco              \\
        VOL+           & Aumento della velocità di caduta     \\
        VOL-           & Diminuzione della velocità di caduta \\
        \bottomrule
    \end{tabular}
\end{table}

\subsubsection{Encoder Rotativo}
\label{subsubsec:encoder}
L'encoder rotativo offre un controllo analogico della velocità di gioco:
\begin{itemize}
    \item \textbf{Rotazione in senso orario}: aumento della velocità di caduta
    \item \textbf{Rotazione in senso antiorario}: diminuzione della velocità di caduta
\end{itemize}

\section{Il Gioco}
\label{sec:gioco}
Tetris è un puzzle game in cui il giocatore deve manipolare tetramini (forme composte da 4 blocchi) che cadono dall'alto nel campo di gioco. L'obiettivo è:
\begin{itemize}
    \item Ruotare e posizionare i tetramini per completare righe orizzontali
    \item Quando una riga è completa, essa scompare e il giocatore guadagna punti
    \item Il gioco termina quando i tetramini impilati raggiungono la parte superiore del campo
\end{itemize}

\subsection{Tetramini}
\label{subsec:tetramini}
I tetramini implementati nel gioco sono rappresentati nella Tabella \ref{tab:tetramini}:

\begin{table}[H]
    \centering
    \caption{Rappresentazione dei tetramini}
    \label{tab:tetramini}
    \begin{tabular}{
            >{\bfseries}l   % Nome
            c               % Codici binari
            c               % Dimensioni
            l               % Rappresentazione
        }
        \toprule
        Pezzo & Codici binari                                      & W\(\times\)H & Forma \\
        \midrule
        I     & \makecell{\texttt{0b1111}                                                 \\\texttt{0b0000}\\\texttt{0b0000}\\\texttt{0b0000}}
              & 4\(\times\)1
              & \makecell{\RedBlock\RedBlock\RedBlock\RedBlock}                           \\
        \addlinespace
        J     & \makecell{\texttt{0b0111}                                                 \\\texttt{0b0100}}
              & 3\(\times\)2
              & \makecell{\WhiteBlock\RedBlock\RedBlock\RedBlock                          \\\WhiteBlock\RedBlock\WhiteBlock\WhiteBlock} \\
        \addlinespace
        L     & \makecell{\texttt{0b1110}                                                 \\\texttt{0b0010}}
              & 3\(\times\)2
              & \makecell{\RedBlock\RedBlock\RedBlock\WhiteBlock                          \\\WhiteBlock\RedBlock\WhiteBlock\WhiteBlock} \\
        \addlinespace
        O     & \makecell{\texttt{0b0110}                                                 \\\texttt{0b0110}}
              & 2\(\times\)2
              & \makecell{\WhiteBlock\RedBlock\RedBlock\WhiteBlock                        \\\WhiteBlock\RedBlock\RedBlock\WhiteBlock} \\
        \addlinespace
        S     & \makecell{\texttt{0b0111}                                                 \\\texttt{0b0010}}
              & 3\(\times\)2
              & \makecell{\WhiteBlock\RedBlock\RedBlock\RedBlock                          \\\WhiteBlock\WhiteBlock\RedBlock\WhiteBlock} \\
        \addlinespace
        T     & \makecell{\texttt{0b1100}                                                 \\\texttt{0b0110}}
              & 3\(\times\)2
              & \makecell{\RedBlock\RedBlock\WhiteBlock\WhiteBlock                        \\\WhiteBlock\RedBlock\RedBlock\WhiteBlock} \\
        \addlinespace
        Z     & \makecell{\texttt{0b1110}                                                 \\\texttt{0b1000}}
              & 3\(\times\)2
              & \makecell{\RedBlock\RedBlock\RedBlock\WhiteBlock                          \\\RedBlock\WhiteBlock\WhiteBlock\WhiteBlock} \\
        \bottomrule
    \end{tabular}
\end{table}

\section{Ambienti di Sviluppo}
\label{sec:ambienti}
Il progetto è stato sviluppato per essere eseguibile in due configurazioni:
\begin{itemize}
    \item \textbf{Hardware fisico}: con la scheda Elegoo UNO R3 e tutti i componenti connessi
    \item \textbf{Simulatore}: per test e sviluppo senza hardware fisico
\end{itemize}

La configurazione dell'ambiente avviene tramite la costante \texttt{PRODUCTION} nel file sorgente principale:
\begin{itemize}
    \item \texttt{PRODUCTION = true}: per l'utilizzo con hardware fisico
    \item \texttt{PRODUCTION = false}: per l'utilizzo con il simulatore
\end{itemize}

Questa differenziazione è necessaria principalmente per gestire i diversi codici infrarossi generati dal telecomando nei due ambienti.

\section{Setup Hardware}
\label{sec:setup}
Questa sezione descrive il collegamento dei vari componenti al microcontrollore.

\subsection{Display a matrice LED (MAX7219)}
\label{subsec:setup-max7219}
Collegamenti tra il modulo MAX7219 e il microcontrollore:

\begin{table}[H]
    \centering
    \caption{Collegamenti Matrix (MAX7219) - Microcontrollore}
    \label{tab:matrix-max7219-connections}
    \begin{tabular}{ll}
        \toprule
        \textbf{Matrix Pin} & \textbf{Microcontrollore Pin} \\
        \midrule
        VCC                 & 5V                            \\
        GND                 & GND                           \\
        DIN                 & Pin 12                        \\
        CS                  & Pin 10                        \\
        CLK                 & Pin 11                        \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Display LCD 16x2}
\label{subsec:setup-lcd}
Collegamenti tra il modulo LCD 1602 e il microcontrollore:

\begin{table}[H]
    \centering
    \caption{Collegamenti LCD Display (16x2) - Microcontrollore}
    \label{tab:lcd-16x2-connections}
    \begin{tabular}{ll}
        \toprule
        \textbf{LCD Pin} & \textbf{Microcontrollore Pin}      \\
        \midrule
        RS               & Pin 13                             \\
        E                & Pin 9                              \\
        D4               & Pin 6                              \\
        D5               & Pin 5                              \\
        D6               & Pin 7                              \\
        D7               & Pin 4                              \\
        VSS              & GND                                \\
        VDD              & 5V                                 \\
        RW               & GND                                \\
        A (Anodo)        & 5V (attraverso resistenza da 220 \(\Omega\)) \\
        K (Catodo)       & GND                                \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Ricevitore Infrarossi (IR)}
\label{subsec:setup-ir}
Collegamenti tra il modulo ricevitore IR e il microcontrollore:

\begin{table}[H]
    \centering
    \caption{Collegamenti IR Receiver Module - Microcontrollore}
    \label{tab:ir-receiver-connections}
    \begin{tabular}{ll}
        \toprule
        \textbf{IR Pin} & \textbf{Microcontrollore Pin} \\
        \midrule
        VCC             & 5V                            \\
        GND             & GND                           \\
        OUT/Data        & Pin 3                         \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Encoder Rotativo}
\label{subsec:setup-encoder}
Collegamenti tra l'encoder rotativo e il microcontrollore:

\begin{table}[H]
    \centering
    \caption{Collegamenti Rotary Encoder Module - Microcontrollore}
    \label{tab:rotary-encoder-connections}
    \begin{tabular}{ll}
        \toprule
        \textbf{Encoder Pin} & \textbf{Microcontrollore Pin} \\
        \midrule
        CLK                  & Pin 2                         \\
        DT                   & Pin 8                         \\
        SW (Switch)          & Non utilizzato                \\
        VCC                  & 5V                            \\
        GND                  & GND                           \\
        \bottomrule
    \end{tabular}
\end{table}


\end{document}